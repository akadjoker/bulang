<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuLang DOM Debug</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }
        
        .test-area {
            background: #252526;
            border: 2px solid #00d9ff;
            padding: 20px;
            margin: 20px 0;
            min-height: 100px;
        }
        
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #1177bb;
        }
        
        #output {
            background: #000;
            color: #0f0;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ BuLang DOM Debug</h1>
    
    <div id="status">‚è≥ Loading...</div>
    
    <h2>Test Buttons</h2>
    <button onclick="test1()">Test 1: Simple Print</button>
    <button onclick="test2()">Test 2: Console Log</button>
    <button onclick="test3()">Test 3: DOM Set HTML</button>
    <button onclick="test4()">Test 4: DOM Create</button>
    <button onclick="test5()">Test 5: Canvas</button>
    
    <h2>DOM Test Area</h2>
    <div id="test-area" class="test-area">
        <p>DOM elements will appear here...</p>
    </div>
    
    <h2>Output Console</h2>
    <div id="output"></div>

    <script>
        let Module = null;
        let log = [];
        
        function addLog(msg, color = '#0f0') {
            log.push(msg);
            const output = document.getElementById('output');
            output.innerHTML = log.join('\n');
            console.log(msg);
        }
        
        // Load WASM
        const script = document.createElement('script');
        script.src = 'bulang.js';
        script.onload = async () => {
            addLog('üì¶ Loading BuLang module...');
            try {
                Module = await createBuLangModule();
                addLog('‚úÖ Module loaded!');
                addLog('Available functions: ' + Object.keys(Module).join(', '));
                document.getElementById('status').textContent = '‚úÖ Ready';
                document.getElementById('status').style.color = '#0f0';
            } catch (e) {
                addLog('‚ùå Error: ' + e.message, '#f00');
            }
        };
        script.onerror = () => {
            addLog('‚ùå Failed to load bulang.js', '#f00');
        };
        document.body.appendChild(script);
        
        // Test functions
        function test1() {
            addLog('\n=== TEST 1: Simple Print ===');
            try {
                Module.executeCode('print("Hello from BuLang!");');
                addLog('‚úÖ Print executed');
            } catch (e) {
                addLog('‚ùå Error: ' + e.message);
            }
        }
        
        function test2() {
            addLog('\n=== TEST 2: Console Log ===');
            try {
                Module.executeCode('console_log("Test console log");');
                addLog('‚úÖ Console log executed');
            } catch (e) {
                addLog('‚ùå Error: ' + e.message);
            }
        }
        
        function test3() {
            addLog('\n=== TEST 3: DOM Set HTML ===');
            try {
                const code = 'dom_set_html("test-area", "<h3 style=\'color:#00d9ff\'>Hello from BuLang DOM!</h3>");';
                addLog('Code: ' + code);
                Module.executeCode(code);
                addLog('‚úÖ DOM set html executed');
                
                // Check if it worked
                const testArea = document.getElementById('test-area');
                addLog('DOM content after: ' + testArea.innerHTML.substring(0, 100));
            } catch (e) {
                addLog('‚ùå Error: ' + e.message);
            }
        }
        
        function test4() {
            addLog('\n=== TEST 4: DOM Create ===');
            try {
                const code = `
var div = dom_create("div");
print("Created div with id: " + div);
dom_set_text(div, "Dynamic div!");
dom_set_attr(div, "style", "background:#e74c3c;color:white;padding:15px;margin:10px 0;");
dom_append("test-area", div);
console_log("Div appended!");
`;
                addLog('Code: ' + code);
                Module.executeCode(code);
                addLog('‚úÖ DOM create executed');
                
                // Check DOM
                const testArea = document.getElementById('test-area');
                addLog('Children count: ' + testArea.children.length);
            } catch (e) {
                addLog('‚ùå Error: ' + e.message);
            }
        }
        
        function test5() {
            addLog('\n=== TEST 5: Canvas ===');
            try {
                const code = `
var id = canvas_in_output(400, 200);
print("Canvas id: " + id);

canvas_set_fill_style(id, "#2196F3");
canvas_fill_rect(id, 0, 0, 400, 200);

canvas_set_fill_style(id, "#fff");
canvas_set_font(id, "bold 24px sans-serif");
canvas_fill_text(id, "BuLang Canvas!", 100, 120);

console_log("Canvas drawn!");
`;
                addLog('Code: ' + code);
                Module.executeCode(code);
                addLog('‚úÖ Canvas executed');
            } catch (e) {
                addLog('‚ùå Error: ' + e.message);
            }
        }
        
        // Override console to capture
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('CONSOLE: ' + args.join(' '));
        };
        
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR: ' + args.join(' '), '#f00');
        };
    </script>
</body>
</html>